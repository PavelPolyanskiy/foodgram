import json
import os

from django.conf import settings
from django.core.management.base import BaseCommand
from django.contrib.auth import get_user_model

from recipe.models import Recipe

User = get_user_model()


class Command(BaseCommand):
    help = 'Импорт данных из CSV файлов'

    def handle(self, *args, **kwargs):
        data_dir = os.path.join(settings.BASE_DIR, 'data')

        file_data = self.__get_data_from_file(data_dir, 'recipes.json')
        for el in file_data:
            Recipe.objects.update_or_create(
                author=el['name'],
                slug=el['slug']
            )

    def _create_user(self):
        User.objects.create(
            email='chef@foodgram.ru',
            username='autochef',
            first_name='Повар',
            last_name='Шеф'
        )

    def __get_data_from_file(self, data_dir, file_name):
        with open(
            file=os.path.join(data_dir, file_name),
            encoding='utf-8'
        ) as file:
            data = json.load(file)
        return data
